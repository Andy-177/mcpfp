<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft皮肤头像生成器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#8B5CF6',
                        dark: '#1F2937',
                        light: '#F3F4F6'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .shadow-custom {
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            }
            .transition-custom {
                transition: all 0.3s ease;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-light to-gray-200 min-h-screen font-sans text-dark">
    <div class="container mx-auto px-4 py-8 max-w-3xl">
        <!-- 头部标题 -->
        <header class="text-center mb-10">
            <h1 class="text-[clamp(2rem,5vw,3rem)] font-bold text-dark mb-2">
                <i class="fa fa-picture-o text-primary mr-3"></i>Minecraft皮肤头像生成器
            </h1>
            <p class="text-gray-600 max-w-2xl mx-auto">上传64x64的Minecraft皮肤文件，生成个性化头像，支持自定义背景和阴影效果</p>
        </header>

        <!-- 主要内容区 - 单栏布局 -->
        <main class="space-y-8">
            <!-- 第一部分：上传和设置区域 -->
            <div class="bg-white rounded-xl shadow-custom p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fa fa-cogs text-primary mr-2"></i>设置
                </h2>
                
                <!-- 文件上传区域 -->
                <div class="mb-6">
                    <label for="skinUpload" class="block text-gray-700 mb-2 font-medium">上传皮肤文件 (64x64 PNG)</label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-primary transition-custom cursor-pointer" id="dropArea">
                        <i class="fa fa-cloud-upload text-4xl text-gray-400 mb-2"></i>
                        <p class="text-gray-500">拖放文件到这里，或<span class="text-primary font-medium">点击选择</span></p>
                        <input type="file" id="skinUpload" accept="image/png" class="hidden" />
                        <p id="fileInfo" class="mt-2 text-sm text-gray-500 hidden"></p>
                    </div>
                    <p id="fileError" class="mt-2 text-sm text-red-500 hidden"></p>
                    <p id="shadowError" class="mt-2 text-sm text-orange-500 hidden"></p>
                </div>
                
                <!-- 背景设置 -->
                <div class="mb-6" id="backgroundSettings" style="display: none;">
                    <h3 class="text-lg font-medium mb-3 flex items-center">
                        <i class="fa fa-image text-primary mr-2"></i>背景设置
                    </h3>
                    <div class="flex items-center mb-3">
                        <input type="radio" id="transparentBg" name="bgType" value="transparent" checked class="mr-2">
                        <label for="transparentBg">透明背景</label>
                    </div>
                    <div class="flex items-center mb-3">
                        <input type="radio" id="colorBg" name="bgType" value="color" class="mr-2">
                        <label for="colorBg">纯色背景</label>
                    </div>
                    <div class="flex items-center mb-3" id="gradientOption">
                        <input type="radio" id="gradientBg" name="bgType" value="gradient" class="mr-2">
                        <label for="gradientBg">渐变背景 (左上角到右下角)</label>
                    </div>
                    <div id="colorPickerContainer" class="mt-3 hidden">
                        <label class="block text-gray-700 mb-2">选择背景颜色</label>
                        <div class="flex items-center">
                            <input type="color" id="bgColor" value="#ffffff" class="w-10 h-10 border border-gray-300 rounded">
                            <div class="ml-3 flex-1">
                                <label for="bgHex" class="block text-xs text-gray-500 mb-1">十六进制 (例如: #FF0000)</label>
                                <input type="text" id="bgHex" value="#ffffff" class="w-full px-3 py-2 border border-gray-300 rounded" placeholder="#RRGGBB">
                            </div>
                        </div>
                    </div>
                    <div id="gradientPickerContainer" class="mt-3 hidden space-y-3">
                        <label class="block text-gray-700 mb-2">选择渐变颜色</label>
                        <div class="flex items-center">
                            <input type="color" id="gradientColor1" value="#ffffff" class="w-10 h-10 border border-gray-300 rounded">
                            <div class="ml-3 flex-1">
                                <label for="gradientHex1" class="block text-xs text-gray-500 mb-1">渐变起点颜色</label>
                                <input type="text" id="gradientHex1" value="#ffffff" class="w-full px-3 py-2 border border-gray-300 rounded" placeholder="#RRGGBB">
                            </div>
                        </div>
                        <div class="flex items-center">
                            <input type="color" id="gradientColor2" value="#000000" class="w-10 h-10 border border-gray-300 rounded">
                            <div class="ml-3 flex-1">
                                <label for="gradientHex2" class="block text-xs text-gray-500 mb-1">渐变终点颜色 (右下角)</label>
                                <input type="text" id="gradientHex2" value="#000000" class="w-full px-3 py-2 border border-gray-300 rounded" placeholder="#RRGGBB">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 阴影设置 -->
                <div class="mb-6" id="shadowSettings" style="display: none;">
                    <h3 class="text-lg font-medium mb-3 flex items-center">
                        <i class="fa fa-moon-o text-primary mr-2"></i>阴影设置
                    </h3>
                    <div class="flex items-center mb-3">
                        <input type="checkbox" id="skinShadow" class="mr-2">
                        <label for="skinShadow">添加皮肤阴影</label>
                    </div>
                    <div class="flex items-center mb-3">
                        <input type="checkbox" id="dropShadow" class="mr-2">
                        <label for="dropShadow">添加头像阴影</label>
                    </div>
                </div>
                
                <!-- 尺寸设置 -->
                <div class="mb-6" id="sizeSettings" style="display: none;">
                    <h3 class="text-lg font-medium mb-3 flex items-center">
                        <i class="fa fa-arrows-alt text-primary mr-2"></i>尺寸设置
                    </h3>
                    <div class="flex flex-col space-y-3">
                        <div class="flex items-center">
                            <input type="radio" id="size300" name="avatarSize" value="300" checked class="mr-2">
                            <label for="size300">300x300 像素 (标准尺寸)</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="size20" name="avatarSize" value="20" class="mr-2">
                            <label for="size20">20x20 像素 (小尺寸)</label>
                        </div>
                    </div>
                </div>
                
                <!-- 生成按钮 -->
                <button id="generateBtn" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-custom flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    <i class="fa fa-magic mr-2"></i>生成头像
                </button>
            </div>
            
            <!-- 第二部分：预览和结果区域 -->
            <div class="bg-white rounded-xl shadow-custom p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fa fa-eye text-primary mr-2"></i>预览
                </h2>
                
                <!-- 原始皮肤预览 -->
                <div class="mb-6" id="originalSkinContainer" style="display: none;">
                    <h3 class="text-lg font-medium mb-2">原始皮肤</h3>
                    <div class="bg-gray-100 rounded-lg p-4 flex justify-center">
                        <canvas id="originalSkinCanvas" width="64" height="64" class="border border-gray-200"></canvas>
                    </div>
                </div>
                
                <!-- 处理后的头像预览 -->
                <div class="mb-6" id="resultContainer" style="display: none;">
                    <h3 class="text-lg font-medium mb-2">生成结果</h3>
                    <div class="bg-gray-100 rounded-lg p-4 flex justify-center">
                        <canvas id="resultCanvas" width="300" height="300" class="border border-gray-200"></canvas>
                    </div>
                </div>
                
                <!-- 下载按钮 -->
                <div id="downloadContainer" style="display: none;">
                    <a id="downloadLink" href="#" download="minecraft_avatar.png" class="w-full inline-block bg-secondary hover:bg-secondary/90 text-white font-medium py-3 px-4 rounded-lg transition-custom text-center">
                        <i class="fa fa-download mr-2"></i>下载头像
                    </a>
                </div>
                
                <!-- 步骤提示 -->
                <div id="stepsContainer" class="text-center text-gray-600">
                    <div class="flex flex-col items-center justify-center h-64">
                        <i class="fa fa-upload text-5xl text-gray-300 mb-4"></i>
                        <p>请先上传64x64的PNG皮肤文件</p>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- 页脚 -->
        <footer class="mt-12 text-center text-gray-500 text-sm">
            <p>© 2023 Minecraft皮肤头像生成器 | 使用HTML5 Canvas技术</p>
        </footer>
    </div>

    <script>
        // 全局变量
        let skinImage = null;
        let skinShadowImage = null;
        let dropShadowImage = null;
        let shadowImagesLoaded = false;
        
        // DOM元素
        const dropArea = document.getElementById('dropArea');
        const skinUpload = document.getElementById('skinUpload');
        const fileInfo = document.getElementById('fileInfo');
        const fileError = document.getElementById('fileError');
        const shadowError = document.getElementById('shadowError');
        const generateBtn = document.getElementById('generateBtn');
        const originalSkinContainer = document.getElementById('originalSkinContainer');
        const originalSkinCanvas = document.getElementById('originalSkinCanvas');
        const resultContainer = document.getElementById('resultContainer');
        const resultCanvas = document.getElementById('resultCanvas');
        const downloadContainer = document.getElementById('downloadContainer');
        const downloadLink = document.getElementById('downloadLink');
        const stepsContainer = document.getElementById('stepsContainer');
        const backgroundSettings = document.getElementById('backgroundSettings');
        const shadowSettings = document.getElementById('shadowSettings');
        const sizeSettings = document.getElementById('sizeSettings');
        const transparentBg = document.getElementById('transparentBg');
        const colorBg = document.getElementById('colorBg');
        const gradientBg = document.getElementById('gradientBg');
        const gradientOption = document.getElementById('gradientOption');
        const colorPickerContainer = document.getElementById('colorPickerContainer');
        const gradientPickerContainer = document.getElementById('gradientPickerContainer');
        const bgColor = document.getElementById('bgColor');
        const bgHex = document.getElementById('bgHex');
        const gradientColor1 = document.getElementById('gradientColor1');
        const gradientHex1 = document.getElementById('gradientHex1');
        const gradientColor2 = document.getElementById('gradientColor2');
        const gradientHex2 = document.getElementById('gradientHex2');
        const skinShadow = document.getElementById('skinShadow');
        const dropShadow = document.getElementById('dropShadow');
        const size300 = document.getElementById('size300');
        const size20 = document.getElementById('size20');
        
        // 初始化：加载本地阴影图片
        function loadShadowImages() {
            let loadedCount = 0;
            const totalImages = 2;
            
            // 加载皮肤阴影图片
            skinShadowImage = new Image();
            skinShadowImage.crossOrigin = "anonymous";
            skinShadowImage.onload = function() {
                loadedCount++;
                checkAllImagesLoaded(loadedCount, totalImages);
            };
            skinShadowImage.onerror = function() {
                showShadowWarning('无法加载皮肤阴影图片，请确保文件存在');
                loadedCount++;
                checkAllImagesLoaded(loadedCount, totalImages);
            };
            skinShadowImage.src = 'skin_shadow.png?' + new Date().getTime(); // 添加时间戳防止缓存
            
            // 加载头像阴影图片
            dropShadowImage = new Image();
            dropShadowImage.crossOrigin = "anonymous";
            dropShadowImage.onload = function() {
                loadedCount++;
                checkAllImagesLoaded(loadedCount, totalImages);
            };
            dropShadowImage.onerror = function() {
                showShadowWarning('无法加载头像阴影图片，请确保文件存在');
                loadedCount++;
                checkAllImagesLoaded(loadedCount, totalImages);
            };
            dropShadowImage.src = 'shadow.png?' + new Date().getTime(); // 添加时间戳防止缓存
        }
        
        // 检查所有阴影图片是否加载完成
        function checkAllImagesLoaded(loaded, total) {
            if (loaded === total) {
                shadowImagesLoaded = true;
                updateUIState();
            }
        }
        
        // 显示阴影图片加载警告
        function showShadowWarning(message) {
            shadowError.textContent = message;
            shadowError.classList.remove('hidden');
        }
        
        // 处理文件上传
        function handleFileUpload(file) {
            // 检查文件类型
            if (!file.type.match('image/png')) {
                showError('请上传PNG格式的图片文件');
                return false;
            }
            
            // 读取文件
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    // 检查图片尺寸
                    if (img.width !== 64 || img.height !== 64) {
                        showError('图片尺寸必须为64x64像素');
                        skinImage = null;
                        updateUIState();
                        return;
                    }
                    
                    // 图片符合要求
                    skinImage = img;
                    showFileInfo(file.name);
                    hideError();
                    
                    // 显示原始皮肤预览
                    const ctx = originalSkinCanvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, 64, 64);
                    
                    // 更新UI状态
                    updateUIState();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
            return true;
        }
        
        // 显示文件信息
        function showFileInfo(fileName) {
            fileInfo.textContent = `已选择: ${fileName}`;
            fileInfo.classList.remove('hidden');
        }
        
        // 显示错误信息
        function showError(message) {
            fileError.textContent = message;
            fileError.classList.remove('hidden');
        }
        
        // 隐藏错误信息
        function hideError() {
            fileError.classList.add('hidden');
        }
        
        // 根据选择的尺寸显示/隐藏渐变选项
        function updateGradientVisibility() {
            const isSmallSize = size20.checked;
            
            // 如果选择小尺寸，隐藏渐变选项并确保选中其他选项
            if (isSmallSize) {
                gradientOption.classList.add('hidden');
                gradientPickerContainer.classList.add('hidden');
                
                // 如果当前选中的是渐变，自动切换到纯色
                if (gradientBg.checked) {
                    colorBg.checked = true;
                    colorPickerContainer.classList.remove('hidden');
                }
            } else {
                // 大尺寸显示渐变选项
                gradientOption.classList.remove('hidden');
                if (gradientBg.checked) {
                    gradientPickerContainer.classList.remove('hidden');
                }
            }
        }
        
        // 更新UI状态
        function updateUIState() {
            const hasValidSkin = skinImage !== null;
            
            // 更新按钮状态 - 只有当皮肤和阴影图片都加载完成才能生成
            generateBtn.disabled = !hasValidSkin || !shadowImagesLoaded;
            
            // 显示/隐藏设置区域
            backgroundSettings.style.display = hasValidSkin ? 'block' : 'none';
            shadowSettings.style.display = hasValidSkin ? 'block' : 'none';
            sizeSettings.style.display = hasValidSkin ? 'block' : 'none';
            
            // 根据尺寸更新渐变选项可见性
            if (hasValidSkin) {
                updateGradientVisibility();
            }
            
            // 显示/隐藏预览区域
            originalSkinContainer.style.display = hasValidSkin ? 'block' : 'none';
            stepsContainer.style.display = hasValidSkin ? 'none' : 'block';
            
            // 如果没有有效皮肤，隐藏结果和下载区域
            if (!hasValidSkin) {
                resultContainer.style.display = 'none';
                downloadContainer.style.display = 'none';
            }
        }
        
        // 解析十六进制颜色
        function parseHex(hex) {
            // 移除#号（如果存在）
            hex = hex.replace(/^#/, '');
            
            // 检查长度是否有效
            if (hex.length !== 6) {
                return null;
            }
            
            // 解析RGB值
            const r = parseInt(hex.substring(0, 2), 16);
            const g = parseInt(hex.substring(2, 4), 16);
            const b = parseInt(hex.substring(4, 6), 16);
            
            // 检查值是否有效
            if (isNaN(r) || isNaN(g) || isNaN(b)) {
                return null;
            }
            
            return [r, g, b];
        }
        
        // 同步颜色选择器
        function syncColorInputs() {
            // 纯色背景颜色同步
            bgColor.addEventListener('input', () => {
                const hex = bgColor.value.toUpperCase();
                bgHex.value = hex;
            });
            
            bgHex.addEventListener('input', () => {
                const hex = bgHex.value.trim();
                if (/^#?[0-9A-Fa-f]{6}$/.test(hex)) {
                    const formattedHex = hex.startsWith('#') ? hex : `#${hex}`;
                    bgColor.value = formattedHex;
                }
            });
            
            // 渐变颜色1同步
            gradientColor1.addEventListener('input', () => {
                const hex = gradientColor1.value.toUpperCase();
                gradientHex1.value = hex;
            });
            
            gradientHex1.addEventListener('input', () => {
                const hex = gradientHex1.value.trim();
                if (/^#?[0-9A-Fa-f]{6}$/.test(hex)) {
                    const formattedHex = hex.startsWith('#') ? hex : `#${hex}`;
                    gradientColor1.value = formattedHex;
                }
            });
            
            // 渐变颜色2同步
            gradientColor2.addEventListener('input', () => {
                const hex = gradientColor2.value.toUpperCase();
                gradientHex2.value = hex;
            });
            
            gradientHex2.addEventListener('input', () => {
                const hex = gradientHex2.value.trim();
                if (/^#?[0-9A-Fa-f]{6}$/.test(hex)) {
                    const formattedHex = hex.startsWith('#') ? hex : `#${hex}`;
                    gradientColor2.value = formattedHex;
                }
            });
            
            // 背景类型切换
            transparentBg.addEventListener('change', () => {
                colorPickerContainer.classList.add('hidden');
                gradientPickerContainer.classList.add('hidden');
            });
            
            colorBg.addEventListener('change', () => {
                colorPickerContainer.classList.remove('hidden');
                gradientPickerContainer.classList.add('hidden');
            });
            
            gradientBg.addEventListener('change', () => {
                if (!size20.checked) { // 只有大尺寸才显示渐变选择器
                    colorPickerContainer.classList.add('hidden');
                    gradientPickerContainer.classList.remove('hidden');
                }
            });
            
            // 尺寸选择变化时更新渐变选项可见性
            size300.addEventListener('change', updateGradientVisibility);
            size20.addEventListener('change', updateGradientVisibility);
        }
        
        // 分割皮肤并生成头像
        function generateAvatar() {
            // 获取选中的尺寸
            const avatarSize = size300.checked ? 300 : 20;
            
            // 创建临时画布用于处理
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = 20;
            tempCanvas.height = 20;
            const tempCtx = tempCanvas.getContext('2d');
            
            // 创建背景
            if (transparentBg.checked) {
                // 透明背景
                tempCtx.clearRect(0, 0, 20, 20);
            } else if (colorBg.checked || avatarSize === 20) {
                // 纯色背景（小尺寸强制使用纯色）
                let rgb = parseHex(bgHex.value) || [255, 255, 255];
                tempCtx.fillStyle = `rgb(${rgb[0]}, ${rgb[1]}, ${rgb[2]})`;
                tempCtx.fillRect(0, 0, 20, 20);
            } else if (gradientBg.checked) {
                // 渐变背景（仅大尺寸支持）
                const color1 = parseHex(gradientHex1.value) || [255, 255, 255];
                const color2 = parseHex(gradientHex2.value) || [0, 0, 0];
                
                // 创建从左上角到右下角的渐变
                const gradient = tempCtx.createLinearGradient(0, 0, 20, 20);
                gradient.addColorStop(0, `rgb(${color1[0]}, ${color1[1]}, ${color1[2]})`);
                gradient.addColorStop(1, `rgb(${color2[0]}, ${color2[1]}, ${color2[2]})`);
                
                tempCtx.fillStyle = gradient;
                tempCtx.fillRect(0, 0, 20, 20);
            }
            
            // 分割皮肤并绘制各个部分
            // 侧面脸
            tempCtx.drawImage(skinImage, 5, 9, 3, 7, 5, 4, 3, 7);
            // 外面部
            tempCtx.drawImage(skinImage, 33, 9, 3, 7, 5, 4, 3, 7);
            
            // 正面脸
            tempCtx.drawImage(skinImage, 8, 9, 7, 7, 8, 4, 7, 7);
            // 外正面脸
            tempCtx.drawImage(skinImage, 40, 9, 7, 7, 8, 4, 7, 7);
            
            // 左手
            tempCtx.drawImage(skinImage, 37, 52, 2, 7, 13, 13, 2, 7);
            // 外左手
            tempCtx.drawImage(skinImage, 53, 52, 2, 7, 13, 13, 2, 7);
            
            // 身体
            const bodyCanvas = document.createElement('canvas');
            bodyCanvas.width = 8;
            bodyCanvas.height = 9;
            const bodyCtx = bodyCanvas.getContext('2d');
            bodyCtx.drawImage(skinImage, 20, 20, 8, 9, 0, 0, 8, 9);
            // 编辑身体（移除特定像素）
            bodyCtx.clearRect(0, 0, 1, 1);  // (0,0)
            bodyCtx.clearRect(7, 0, 1, 1); // (7,0)
            tempCtx.drawImage(bodyCanvas, 6, 11, 8, 9);
            
            // 外身体
            const outerBodyCanvas = document.createElement('canvas');
            outerBodyCanvas.width = 8;
            outerBodyCanvas.height = 9;
            const outerBodyCtx = outerBodyCanvas.getContext('2d');
            outerBodyCtx.drawImage(skinImage, 20, 36, 8, 9, 0, 0, 8, 9);
            // 编辑外身体
            outerBodyCtx.clearRect(0, 0, 1, 1);  // (0,0)
            outerBodyCtx.clearRect(7, 0, 1, 1); // (7,0)
            tempCtx.drawImage(outerBodyCanvas, 6, 11, 8, 9);
            
            // 右手
            tempCtx.drawImage(skinImage, 45, 20, 2, 7, 5, 13, 2, 7);
            // 外右手
            tempCtx.drawImage(skinImage, 45, 36, 2, 7, 5, 13, 2, 7);
            
            // 添加皮肤阴影
            if (skinShadow.checked && skinShadowImage.complete) {
                tempCtx.drawImage(skinShadowImage, 0, 0, 20, 20);
            }
            
            // 调整结果画布尺寸
            resultCanvas.width = avatarSize;
            resultCanvas.height = avatarSize;
            const resultCtx = resultCanvas.getContext('2d');
            resultCtx.clearRect(0, 0, avatarSize, avatarSize);
            resultCtx.imageSmoothingEnabled = false; // 禁用平滑，保持像素风格
            
            // 绘制最终结果
            if (avatarSize === 300) {
                // 放大到300x300
                resultCtx.drawImage(tempCanvas, 0, 0, 20, 20, 0, 0, 300, 300);
                
                // 添加头像阴影
                if (dropShadow.checked && dropShadowImage.complete) {
                    // 先保存当前结果，然后在下方绘制阴影，再绘制结果
                    const tempResult = resultCtx.getImageData(0, 0, 300, 300);
                    resultCtx.drawImage(dropShadowImage, 0, 0, 300, 300);
                    resultCtx.putImageData(tempResult, 0, 0);
                }
            } else {
                // 保持20x20
                resultCtx.drawImage(tempCanvas, 0, 0, 20, 20);
            }
            
            // 设置下载文件名
            const fileName = avatarSize === 300 ? 'minecraft_avatar.png' : 'minecraft_avatar_Template.png';
            downloadLink.download = fileName;
            
            // 显示结果和下载按钮
            resultContainer.style.display = 'block';
            downloadContainer.style.display = 'block';
            
            // 更新下载链接
            downloadLink.href = resultCanvas.toDataURL('image/png');
        }
        
        // 事件监听
        dropArea.addEventListener('click', () => {
            skinUpload.click();
        });
        
        skinUpload.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });
        
        // 拖放功能
        dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropArea.classList.add('border-primary');
        });
        
        dropArea.addEventListener('dragleave', () => {
            dropArea.classList.remove('border-primary');
        });
        
        dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dropArea.classList.remove('border-primary');
            
            if (e.dataTransfer.files.length > 0) {
                handleFileUpload(e.dataTransfer.files[0]);
            }
        });
        
        // 生成按钮
        generateBtn.addEventListener('click', generateAvatar);
        
        // 初始化颜色输入同步
        syncColorInputs();
        
        // 初始化：加载阴影图片
        loadShadowImages();
        updateUIState();
    </script>
</body>
</html>
    